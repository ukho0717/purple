let Koa,Router,bodyParser,mongoose,api,jwtMiddleware,SocketIo,socketEvents;_d7c‍.w("koa",[["default",["Koa"],function(v){Koa=v}]]);_d7c‍.w("koa-router",[["default",["Router"],function(v){Router=v}]]);_d7c‍.w("koa-bodyparser",[["default",["bodyParser"],function(v){bodyParser=v}]]);_d7c‍.w("mongoose",[["default",["mongoose"],function(v){mongoose=v}]]);_d7c‍.w("./api",[["default",["api"],function(v){api=v}]]);_d7c‍.w("./lib/jwtMiddleware",[["default",["jwtMiddleware"],function(v){jwtMiddleware=v}]]);_d7c‍.w("socket.io",[["default",["SocketIo"],function(v){SocketIo=v}]]);_d7c‍.w("./socket.js",[["default",["socketEvents"],function(v){socketEvents=v}]]);require('dotenv').config();
//dsjhdiasjdaskldjaskld
const fs = require('fs')
const serve   = require('koa-static');

// const path = require('path');







// import createFakeData from './createFakeData';


//소켓


//패스포트
let passport = require('passport');
let flash = require('flash');
const logger = require('morgan');

const { PORT, MONGO_URL } = process.env;

mongoose.connect(MONGO_URL, { useNewUrlParser: true, useFindAndModify: false }).then(() => {
    console.log('Connected to MongoDB');
}).catch(e => {
    _d7c‍.g.console.log(e);
});

const app = new Koa();
const router = new Router();
app.use((serve(__dirname + '/uploads')))

router.use('/api', api.routes());
app.use(bodyParser());
app.use(jwtMiddleware);

app.use(router.routes()).use(router.allowedMethods());


// router.use('/uploads',serve(path.resolve(__dirname, './api/enter_gram/uploads')));


var readFileThunk = function(src) {
    return new Promise(function (resolve, reject) {
        fs.readFile(src, {'encoding': 'utf8'}, function (err, data) {
        if(err) return reject(err);
        resolve(data);
    });
    });
}
app.use(serve(__dirname + '/'));
router.get('/contacts', async ctx => {
    ctx.body = await readFileThunk(__dirname + '/message.html');
})

// Passport 사용 설정
// Passport의 세션을 사용하려면 그 전에 Express의 세션을 사용하는 코드가 있어야 합니다.
app.use(passport.initialize());
app.use(passport.session());
app.use(flash());

app.use(logger('dev'));

const port = PORT || 4000;
const server = app.listen(port, () => {
    console.log(`Listening to port ${port}`);
})

const io = SocketIo(server); // socket.io와 서버 연결하는 부분
socketEvents(io); // 아까 만든 이벤트 연결