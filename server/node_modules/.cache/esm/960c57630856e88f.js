let Router,postsCtrl,koaMulter;_085‍.x([["default",()=>_085‍.o]]);_085‍.w("koa-router",[["default",["Router"],function(v){Router=v}]]);_085‍.w("./posts.ctrl",[["*",null,function(v){postsCtrl=v}]]);_085‍.w("koa-multer",[["default",["koaMulter"],function(v){koaMulter=v}]]);

// import koaBody from 'koa-body';


const path = require('path');
// const multer = require('multer');

let storage = koaMulter.diskStorage({
    destination: (req, file, callback) => {
        callback(null, 'src/uploads');
    },
    filename: (req, file, callback) => {
        let extension = path.extname(file.originalname);
        let basename = path.basename(file.originalname, extension);
        callback(null, basename + "_" + Date.now() + extension);
    }
});

let upload = koaMulter({
    storage: storage,
    limits: {
        files: 1,
        fileSize: 1024 * 1024 * 1024
    }
});

const posts = new Router();
posts.get('/like', postsCtrl.likeList);
posts.get('/', postsCtrl.list);

// posts.get('/write', async ctx => {
//     console.log('/write 호출')
//     ctx.body = '<h2>파일 업로드</h2><form method="post" action="/api/posts" enctype="multipart/form-data"><p><label>내용 : <input type="text" name="content"></label></p><p><label>댓글 : <input type="text" name="comment"></label></p><p><label>사진 : <input type="file" name="file"></label></p><p><input type="submit" value="전송"></p></form><div id="prevImage" style="background: gray; width: 300px; height: 300px;"></div>';
// });
// posts.post('/', koaBody({ multipart: true }), upload.array('photo', 1), postsCtrl.write);
posts.post('/', upload.single('file'), postsCtrl.write);

// const post = new Router();
posts.get('/:post_id', postsCtrl.read);
posts.delete('/:post_id', postsCtrl.remove);
// post.patch('/:id', postsCtrl.update);

_085‍.d(posts);